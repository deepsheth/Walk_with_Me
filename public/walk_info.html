<head>
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<!-- Firebase -->
	<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
	<script>
	// Initialize Firebase
	var config = {
		apiKey: "AIzaSyBn3v_1yzu_bEKpxBUCPKtQVJngCYoamgE",
		authDomain: "walk-with-me-2f1f5.firebaseapp.com",
		databaseURL: "https://walk-with-me-2f1f5.firebaseio.com",
		storageBucket: "walk-with-me-2f1f5.appspot.com",
		messagingSenderId: "306025142010"
	};
	firebase.initializeApp(config);
	</script>
	<!-- GeoFire -->
	<script src="https://cdn.firebase.com/libs/geofire/4.1.2/geofire.min.js"></script>
	<!--Import Google Icon Font-->
	<link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	
	<!-- CSS -->
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/css?family=Fredoka+One|Montserrat:400,700" rel="stylesheet">
	<link rel="stylesheet" href="/css/style.css">
	<!-- JS -->
	<!-- Compiled and minified JavaScript -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="/js/WWM-toolkit.js"></script>
	<script type="text/javascript" src="/js/script_details.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBn3v_1yzu_bEKpxBUCPKtQVJngCYoamgE&callback=initMiniMap"
	async defer></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<html>
	<nav>
		<div class="nav-wrapper">
			<a href="/app.html" class="brand-logo">Walk with Me</a>
			<ul class="right hide-on-med-and-down">
				<li><a href="profile.html">Past Walks</a></li>
				<li><a id="btn_log_out">Log Out</a></li>
			</ul>
			<ul id="slide-out" class="side-nav">
				<li><div class="userView">
					<div class="background">
						<img src="http://cdn-7.nikon-cdn.com/Images/Learn-Explore/Photography-Techniques/2012/Bokeh-for-Beginners/Media/Bokeh-1-JodyDole-1.jpg">
					</div>
					<a href="#!user"><img class="circle" src="https://avatars3.githubusercontent.com/u/8071305"></a>
					<a href="#!name"><span class="white-text name">Deep Sheth</span></a>
					<a href="#!email"><span class="white-text email">deepsheth@lehigh.com</span></a>
				</div></li>
				<li><a href="profile.html"><i class="material-icons">history</i>Past Walks</a></li>
				<li><a href="login.html"><i class="material-icons">account_circle</i>Log In</a></li>
				<li><div class="divider"></div></li>
				<li><a href="!#"><i class="material-icons"></i>Log Out</a></li>
			</ul>
			<a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>
		</div>
	</nav>
	
	<div class="container">
		<div class="section">
			<div class="section">
				<div class="center">
					<div class="col s11 dyn_title_row">
						<h3 class="dyn_title_text">
						<div class="dyn_avatar">
							<i class="material-icons tiny-icon circle green tiny white-text walk-icon">directions_walk</i>
						</div>
						Walk with <span class="dyn_username"></span> to <span class="dyn_dest"></span>
						</h3>
					
					</div>
				</div>
				<div class="row">
					<div class="col s12 center">
						<h5><strong><span class="dyn_date"></span></strong> at <span class="dyn_time"></span></h5>
					</div>
				</div>
				<div class="row center">
					<div class="section">
						<div class="col s12">
							<div id="mini-map">
								
							</div>
						</div>
					</div>
				</div>
				<div class="row center">
					<div class="col s12">
						<a class="btn btn-large green white-text btn-flat dyn_chat">
						<i class="material-icons left">message</i>View Messages with <span class="dyn_username"></span>
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">

// DUPLICATE!!
function addHoverMarkerStart(latitude,longitude, type) {
	var pos = {
		lat: latitude,
		lng: longitude
	}

	var mkr;
	if (type == "start") {
		mkr = {
	          path: 'm12 0c-4.4183 2.3685e-15 -8 3.5817-8 8 0 1.421 0.3816 2.75 1.0312 3.906 0.1079 0.192 0.221 0.381 0.3438 0.563l6.625 11.531 6.625-11.531c0.102-0.151 0.19-0.311 0.281-0.469l0.063-0.094c0.649-1.156 1.031-2.485 1.031-3.906 0-4.4183-3.582-8-8-8zm0 4c2.209 0 4 1.7909 4 4 0 2.209-1.791 4-4 4-2.2091 0-4-1.791-4-4 0-2.2091 1.7909-4 4-4z',
	          scale: 1.75,
	          fillColor: '#0769AD',
	          fillOpacity: 1,
	          strokeColor: '#004A7C',
	          strokeWeight: 3
	    };
	}
	else {
		mkr = {
	          path: 'm12 0c-4.4183 2.3685e-15 -8 3.5817-8 8 0 1.421 0.3816 2.75 1.0312 3.906 0.1079 0.192 0.221 0.381 0.3438 0.563l6.625 11.531 6.625-11.531c0.102-0.151 0.19-0.311 0.281-0.469l0.063-0.094c0.649-1.156 1.031-2.485 1.031-3.906 0-4.4183-3.582-8-8-8zm0 4c2.209 0 4 1.7909 4 4 0 2.209-1.791 4-4 4-2.2091 0-4-1.791-4-4 0-2.2091 1.7909-4 4-4z',
	          scale: 1.75,
	           fillColor: '#e74c3c',
	          fillOpacity: 1,
	          strokeColor: '#c0392b',
	          strokeWeight: 3
	    };
	}

	return new google.maps.Marker({
    	position: pos,
		icon: mkr,
		title: "null",
		map: map
	});
}


	var walk_id = window.location.href.split("?w=")[1];
	

	$(document).ready(function() {
		firebase.auth().onAuthStateChanged(function(user) {
  			if (user) {
				var walkID = getUrlParameter('w');
				if (!walkID){
					$('a.back').click(function(){
						parent.history.back();
						return false;
					})
				}
				var start_location = [];
				var end_location = [];
				get_walk_data(walkID,"past",user,function(walkData){
					console.log(walkData);
					start_location = [walkData['start_latitude'],walkData['start_longitude']];
					end_location = [walkData['end_latitude'],walkData['end_longitude']];

					// Not actually for hovering
					addHoverMarkerStart(walkData['start_latitude'],walkData['start_longitude'], "start");
					addHoverMarkerStart(walkData['end_latitude'],walkData['end_longitude'], "end");
					if (walkData['poster_id'] == user.uid){
						$('.dyn_username').html(walkData['responder_name']);
						console.log('/chat.html?w='+walkID);
						$('.dyn_chat').attr('href','/chat.html?w='+walkID);
						$('.dyn_dest').html(walkData['destination_name']);
						$('.dyn_avatar').css('background-image', 'url(' + walkData["poster_image"] + ')');


						var storage = firebase.storage();
						var storageRef = storage.ref();

						//create reference to the location in the database
						var imagesRef = storageRef.child('profile_pictures');

						// Get the user id to use as the unique filename for their profile picture

						var uploadRef = imagesRef.child(walkData["poster_id"]);

						//pull the image url, and for example I put it into the display_pro_pic div
						uploadRef.getDownloadURL().then(function(url){
							$('.dyn_avatar').css('background-image', 'url(' + walkData["poster_image"] + ')');
						});

						var time = new Date(walkData['time']);
						var date_string = time.toString().substring(4,16);
						var time_string = time.toString().substring(15,22);
						$('.dyn_date').html(date_string);
						$('.dyn_time').html(time_string);
					}
					else{
						$('.dyn_username').html(walkData['poster_name']);
						console.log('/chat.html?w='+walkID);
						$('.dyn_chat').attr('href','/chat.html?w='+walkID);
						$('.dyn_dest').html(walkData['destination_name']);
						
						var storage = firebase.storage();
						var storageRef = storage.ref();

						//create reference to the location in the database
						var imagesRef = storageRef.child('profile_pictures');

						// Get the user id to use as the unique filename for their profile picture

						var uploadRef = imagesRef.child(walkData["responder_id"]);

						//pull the image url, and for example I put it into the display_pro_pic div
						uploadRef.getDownloadURL().then(function(url){
							$('.dyn_avatar').css('background-image', 'url(' + walkData["poster_image"] + ')');
						});

						var time = new Date(walkData['time']);
						var date_string = time.toString().substring(4,15);
						var time_string = time.toString().substring(15,21);
						$('.dyn_date').html(date_string);
						$('.dyn_time').html(time_string);
					}
				})
			}
		});

		/*var ref = firebase.database().ref('/past_walks/' + walk_id).once('value').then(function(snapshot) {
			renderPage(snapshot.val());
		});*/
	});

	
	/*function renderPage(snap) {
		$('.dyn_username').text(snap.poster_name);
		$('.dyn_dest').text(snap.destination_name);
		$('.dyn_time').text(snap.time);
		$('.dyn_chat').text("/chat.html?w=" + snap.walk_id);

	}*/
	</script>
	
</div>
</html>